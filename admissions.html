<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Admission & APPAR Enrollment - GPS Pethgam Wagoora</title>
    <link rel="stylesheet" href="css/style.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- General Form Styling (Can be moved to style.css) --- */
        body {
            background-color: #f4f4f4;
            color: #333;
        }
        .admission-form-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 30px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .form-section {
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }
        .form-section h3 {
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: #007bff;
        }
        .form-grid {
            /* Adjusted min-width to accommodate 3 columns in the documents section */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px;
        }
        .form-group {
            margin-bottom: 5px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .form-group input:not([type="checkbox"]), .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        .warning-message {
            color: #dc3545;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            margin-top: 15px;
            display: none;
        }
        .submit-btn-container {
            text-align: center;
            margin-top: 40px;
        }
        .submit-btn {
            background-color: #28a745;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .submit-btn:hover {
            background-color: #1e7e34;
        }
        .required-star {
            color: #dc3545;
            margin-left: 3px;
        }
        .declaration-text {
            border: 1px solid #007bff;
            padding: 15px;
            border-radius: 5px;
            background-color: #f7faff;
            font-size: 0.9em;
            margin-top: 20px;
        }
        /* Specific styling for photo upload area */
        .photo-upload-group {
            grid-column: 1 / -1; /* Take full width */
        }
    </style>
</head>
<body>

    <div class="admission-form-container">
        <h1 style="color:#007bff; text-align:center;">Online Admission & APPAR Enrollment Form</h1>
        <h2 style="text-align:center; font-weight:normal; font-size:1.2em;">GPS Pethgam Wagoora (Academic Session 2026)</h2>
        <p style="text-align:center; margin-bottom: 30px;">Fill all sections accurately. The final Unified PDF Packet must be printed and submitted physically to the school office along with original documents.</p>

        <form id="combinedAdmissionForm" method="POST" action="process_form.php" enctype="multipart/form-data">
            
            <div class="form-section">
                <h3>1. Student & Class Details</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="studentName">Students Full Name <span class="required-star">*</span></label>
                        <input type="text" id="studentName" name="studentName" placeholder="First Middle Last" required>
                    </div>
                    <div class="form-group">
                        <label for="nameAsAadhaar">Name As Per Aadhaar <span class="required-star">*</span></label>
                        <input type="text" id="nameAsAadhaar" name="nameAsAadhaar" required>
                    </div>
                    <div class="form-group">
                        <label for="gender">Gender <span class="required-star">*</span></label>
                        <select id="gender" name="gender" required>
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dob">Date of Birth (DOB) <span class="required-star">*</span></label>
                        <input type="date" id="dob" name="dob" onchange="checkAge()" required>
                    </div>
                    <div class="form-group">
                        <label for="admissionType">Admission Type <span class="required-star">*</span></label>
                        <select id="admissionType" name="admissionType" onchange="toggleTransferFields()" required>
                            <option value="">Select Type</option>
                            <option value="fresh">Fresh Admission</option>
                            <option value="transfer">Transfer Admission</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="classApplied">Class Joining <span class="required-star">*</span></label>
                        <select id="classApplied" name="classApplied" onchange="checkAge()" required>
                            <option value="">Select Class</option>
                            <option value="pp3">Pre-Primary 3</option>
                            <option value="pp2">Pre-Primary 2</option>
                            <option value="balvatika">Balvatika</option>
                            <option value="class1">Class 1</option>
                            <option value="class2">Class 2</option>
                            <option value="class3">Class 3</option>
                            <option value="class4">Class 4</option>
                            <option value="class5">Class 5</option>
                        </select>
                    </div>
                    
                    <div class="form-group transfer-field" id="pen-field" style="display:none;">
                        <label for="studentPenNo">PEN Number (if transfer.) <span class="required-star">*</span></label>
                        <input type="text" id="studentPenNo" name="studentPenNo" placeholder="Enter 15-digit PEN">
                    </div>
                </div>
                <div id="ageWarning" class="warning-message"></div>
            </div>

            <div class="form-section">
                <h3>2. Admission Form Details (Parent & Financial)</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="fatherName">Father's Full Name <span class="required-star">*</span></label>
                        <input type="text" id="fatherName" name="fatherName" required>
                    </div>
                    <div class="form-group">
                        <label for="motherName">Mother's Full Name <span class="required-star">*</span></label>
                        <input type="text" id="motherName" name="motherName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="fatherCellNo">Father's Cell No. (10 digits) <span class="required-star">*</span></label>
                        <input type="tel" id="fatherCellNo" name="fatherCellNo" pattern="[0-9]{10}" title="10-digit mobile number" required>
                    </div>
                    <div class="form-group">
                        <label for="motherCellNo">Mother's Cell No. (10 digits)</label>
                        <input type="tel" id="motherCellNo" name="motherCellNo" pattern="[0-9]{10}" title="10-digit mobile number (Optional)">
                    </div>

                    <div class="form-group">
                        <label for="aadhaarNumber">Aadhaar Number <span class="required-star">*</span></label>
                        <input type="text" id="aadhaarNumber" name="aadhaarNumber" pattern="\d{12}" title="12-digit Aadhaar number" required>
                    </div>
                    <div class="form-group">
                        <label for="rationCardNumber">Ration Card Number</label>
                        <input type="text" id="rationCardNumber" name="rationCardNumber">
                    </div>
                    
                    <div class="form-group">
                        <label for="bankAccountNumber">Bank Account Number</label>
                        <input type="text" id="bankAccountNumber" name="bankAccountNumber">
                    </div>
                    <div class="form-group">
                        <label for="bankName">Bank Name</label>
                        <input type="text" id="bankName" name="bankName">
                    </div>
                    <div class="form-group">
                        <label for="ifscCode">IFSC Code</label>
                        <input type="text" id="ifscCode" name="ifscCode">
                    </div>
                     <div class="form-group">
                        <label for="category">Category <span class="required-star">*</span></label>
                        <select id="category" name="category" required>
                            <option value="GENERAL">GENERAL</option>
                            <option value="SC">SC</option>
                            <option value="ST">ST</option>
                            <option value="OBC">OBC</option>
                            <option value="EWS">EWS</option>
                            <option value="OTHER">OTHER</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bloodGroup">Blood Group <span class="required-star">*</span></label>
                        <select id="bloodGroup" name="bloodGroup" required>
                            <option value="">Select Group</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="residence">Residence (Village / Locality / Street) <span class="required-star">*</span></label>
                    <textarea id="residence" name="residence" rows="2" required></textarea>
                </div>
                <div class="form-group" style="max-width: 300px;">
                    <label for="district">District</label>
                    <input type="text" id="district" name="district" value="Baramulla" readonly>
                </div>

                <h4>Parent's Declaration</h4>
                <div class="form-group declaration-text">
                    <input type="checkbox" id="parentDeclaration" name="parentDeclaration" required style="width: auto; margin-right: 10px;">
                    <label for="parentDeclaration" style="display: inline; font-weight: normal;">
                        I do hereby declare that the above information provided by me is true to the best of my knowledge and belief. I further declare that I will abide by the rules and regulations laid down by the school and the department from time to time and will co-operate with the institution for the betterment of my ward and institution when sought. I hereby consent to provide the **Aadhaar** for the demographic authentication of the student. (**Agreed: tick box on portal**). 
                        <br>
                        Parent/Guardian Name: **<span id="declarationParentName">[Father/Mother Name]</span>**
                    </label>
                </div>
            </div>

            <div class="form-section">
                <h3>3. APPAR ID Generation Consent Details</h3>
                <p>This section captures the consent data required for the APPAR ID Generation form.</p>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="parentConsentProof">Parent/Guardian Identity Proof <span class="required-star">*</span></label>
                        <select id="parentConsentProof" name="parentConsentProof" required>
                            <option value="">Select Proof Type</option>
                            <option value="Aadhaar / PAN / EPIC Voter ID">Aadhaar / PAN / EPIC Voter ID</option>
                            <option value="Driving License">Driving License</option>
                            <option value="Passport">Passport</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="parentProofNumber">Identity Proof Number <span class="required-star">*</span></label>
                        <input type="text" id="parentProofNumber" name="parentProofNumber" required>
                    </div>
                </div>
                
                <div class="form-group declaration-text">
                    <input type="checkbox" id="apparConsent" name="apparConsent" required style="width: auto; margin-right: 10px;">
                    <label for="apparConsent" style="display: inline; font-weight: normal;">
                        I, the Mother/Father/Legal Guardian of the student, hereby voluntarily give my consent to share my **Aadhaar Number and demographic information** with the Ministry of Education for the creation of APAR ID and opening of the DIGILOCKER Account for my child for the purposes stated in the consent form. I confirm I have read and understood the terms.
                    </label>
                </div>
            </div>
<div class="form-section">
    <h3>4. Document Upload (PDF/JPG/PNG)</h3>
    <p>These files will be merged into your final submission packet. Upload clear copies only.</p>
    
    <div class="form-grid">
        <div class="form-group photo-upload-group">
            <label for="uploadPhoto">Passport Size Student Photograph <span class="required-star">*</span></label>
            <input type="file" id="uploadPhoto" name="uploadPhoto" accept=".jpg, .jpeg, .png" required>
        </div>

        <div class="form-group">
            <label for="uploadBirthCert">Birth Certificate (Registrar Births & Deaths) <span class="required-star">*</span></label>
            <input type="file" id="uploadBirthCert" name="uploadBirthCert" accept=".pdf, .jpg, .jpeg, .png" required>
        </div>
        <div class="form-group">
            <label for="uploadBloodReport">Blood Group Report <span class="required-star">*</span></label>
            <input type="file" id="uploadBloodReport" name="uploadBloodReport" accept=".pdf, .jpg, .jpeg, .png" required>
        </div>
        <div class="form-group">
            <label for="uploadStudentAadhaar">Student Aadhaar Card <span class="required-star">*</span></label>
            <input type="file" id="uploadStudentAadhaar" name="uploadStudentAadhaar" accept=".pdf, .jpg, .jpeg, .png" required>
        </div>
        <div class="form-group">
            <label for="uploadParentAadhaar">Parent Aadhaar Card <span class="required-star">*</span></label>
            <input type="file" id="uploadParentAadhaar" name="uploadParentAadhaar" accept=".pdf, .jpg, .jpeg, .png" required>
        </div>
        <div class="form-group transfer-field" id="tc-field" style="display:none;">
            <label for="uploadTC">Transfer Certificate (TC) <span class="required-star">*</span></label>
            <input type="file" id="uploadTC" name="uploadTC" accept=".pdf, .jpg, .jpeg, .png">
        </div>
    </div>
</div>

<div class="submit-btn-container">
    <button type="submit" class="submit-btn" id="submitButton">
        <i class="fas fa-file-download"></i> Submit Application & Generate Unified PDF Packet
    </button>
</div>

</form>
</div>


    <script>
        // Admission year is 2026, so the preceding year is 2025.
        // Cutoff date is November 1st, 2025.
        const CUTOFF_DATE = new Date('2025-11-01');

        // Age requirements (Min Age in years as of CUTOFF_DATE)
        const AGE_REQUIREMENTS = {
            'pp3': 3,       
            'pp2': 4,       
            'balvatika': 5, 
            'class1': 6,
            'class2': 7,
            'class3': 8,
            'class4': 9,
            'class5': 10
        };

        function calculateAge(dob) {
            const studentDob = new Date(dob);
            
            let ageInYears = CUTOFF_DATE.getFullYear() - studentDob.getFullYear();
            const m = CUTOFF_DATE.getMonth() - studentDob.getMonth();
            
            if (m < 0 || (m === 0 && CUTOFF_DATE.getDate() < studentDob.getDate())) {
                ageInYears--;
            }
            return ageInYears;
        }

        function checkAge() {
            const dobInput = document.getElementById('dob');
            const classInput = document.getElementById('classApplied');
            const warningDiv = document.getElementById('ageWarning');
            const submitButton = document.getElementById('submitButton');

            const dobValue = dobInput.value;
            const classValue = classInput.value;
            
            warningDiv.style.display = 'none';
            submitButton.disabled = false;

            if (!dobValue || !classValue) {
                return;
            }

            if (AGE_REQUIREMENTS[classValue]) {
                const ageInYears = calculateAge(dobValue);
                const minAge = AGE_REQUIREMENTS[classValue];

                if (ageInYears < minAge) {
                    warningDiv.innerHTML = `⚠️ **Ineligible for Admission:** The student must be at least **${minAge} years** old as of Nov 1, 2025, for **${classValue.toUpperCase()}**. Current age: ${ageInYears} years.`;
                    warningDiv.style.display = 'block';
                    submitButton.disabled = true;
                } else if (ageInYears > minAge + 2 && classValue.startsWith('class')) { 
                    warningDiv.innerHTML = `⚠️ **Age Caution:** Student age (${ageInYears}) seems high for ${classValue.toUpperCase()}. Please verify the DOB or contact the school office.`;
                    warningDiv.style.display = 'block';
                    submitButton.disabled = false;
                } else {
                    warningDiv.innerHTML = `✅ **Age Check Passed:** Student will be **${ageInYears} years** old on Nov 1, 2025.`;
                    warningDiv.style.display = 'block';
                    submitButton.disabled = false;
                }
            }
        }

        function toggleTransferFields() {
            const type = document.getElementById('admissionType').value;
            const transferFields = document.querySelectorAll('.transfer-field');
            const penInput = document.getElementById('studentPenNo');
            const tcInput = document.getElementById('uploadTC');

            if (type === 'transfer') {
                transferFields.forEach(field => field.style.display = 'block');
                penInput.setAttribute('required', 'required');
                tcInput.setAttribute('required', 'required');
            } else {
                transferFields.forEach(field => field.style.display = 'none');
                penInput.removeAttribute('required');
                tcInput.removeAttribute('required');
                penInput.value = ''; 
                tcInput.value = ''; 
            }
        }
        
        // --- MAIN PDF GENERATION LOGIC (Blueprint for Developer) ---
        async function generateUnifiedPDF(formData) {
            const doc = new jsPDF('p', 'mm', 'a4'); // A4 size, millimeters
            let y = 10;
            const lineHeight = 7;
            const pageWidth = 210;
            const margin = 15;
            const data = {};
            
            // 1. COLLECT ALL FORM DATA (simple key-value pairs)
            formData.forEach((value, key) => data[key] = value);

            // -------------------------------------------------------------
            // A. PAGE 1: ADMISSION FORM (Populate data on a custom template)
            // -------------------------------------------------------------
            doc.setFontSize(16);
            doc.text("Government Primary School Admission Form", pageWidth / 2, y, { align: "center" });
            y += lineHeight;
            
            doc.setFontSize(10);
            y += lineHeight / 2;
            doc.text(`Student Name: ${data.studentName}`, margin, y);
            doc.text(`DOB: ${data.dob}`, pageWidth / 2, y);
            y += lineHeight;

            doc.text(`Father's Name: ${data.fatherName}`, margin, y);
            doc.text(`Mother's Name: ${data.motherName}`, pageWidth / 2, y);
            y += lineHeight;

            // ... Draw all other fields from Section 2 using doc.text() based on your template layout ...

            // Draw the Declaration Text Box (Simplified)
            y += lineHeight * 2;
            doc.rect(margin, y, pageWidth - margin * 2, 30);
            doc.text("Parent's Declaration (Agreed on portal):", margin + 2, y + 4);
            doc.text("I hereby declare that the information is true and consent to Aadhaar authentication.", margin + 2, y + 10);
            y += 35;


            // ----------------------------------------------------------------
            // B. PAGE 2: APPAR CONSENT FORM (Start New Page)
            // ----------------------------------------------------------------
            doc.addPage();
            y = 10;
            doc.setFontSize(16);
            doc.text("APPAR ID Generation Consent Form", pageWidth / 2, y, { align: "center" });
            y += lineHeight * 2;
            
            doc.setFontSize(10);
            doc.text(`Student Name: ${data.studentName}`, margin, y);
            doc.text(`Student Aadhaar: ${data.studentAadhaar}`, pageWidth / 2, y);
            y += lineHeight;
            
            doc.text(`Parent Proof Used: ${data.parentConsentProof}`, margin, y);
            doc.text(`Proof Number: ${data.parentProofNumber}`, pageWidth / 2, y);
            y += lineHeight;

            // Draw the full consent text box here.

            // ----------------------------------------------------------------
            // C. PAGE 3+: UPLOADED DOCUMENTS (Merge Files)
            // ----------------------------------------------------------------
            const uploadedFiles = [
                'uploadPhoto', 
                'uploadBirthCert', 
                'uploadBloodReport', 
                'uploadStudentAadhaar', 
                'uploadParentAadhaar'
            ];
            if (data.admissionType === 'transfer') {
                uploadedFiles.push('uploadTC');
            }

            for (const fileKey of uploadedFiles) {
                const fileInput = document.getElementById(fileKey);
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    const fileReader = new FileReader();

                    await new Promise((resolve) => {
                        fileReader.onload = (e) => {
                            doc.addPage();
                            doc.setFontSize(12);
                            doc.text(`--- Attached Document: ${file.name} (${fileKey}) ---`, margin, 10);
                            
                            // *** DEVELOPER NOTE: PDF and Image handling logic goes here ***
                            // For images (.jpg, .png), draw the image onto the page:
                            // doc.addImage(e.target.result, 'JPEG/PNG', margin, 20, 180, 250); 
                            
                            // For PDFs, advanced libraries (like PDF-Lib with jsPDF) or external services 
                            // are usually needed to merge them correctly. Simply reading the file 
                            // won't automatically embed the PDF content. This part is the most difficult 
                            // step for pure client-side solutions.

                            resolve();
                        };

                        if (file.type.startsWith('image/')) {
                            fileReader.readAsDataURL(file); // For images
                        } else if (file.type === 'application/pdf') {
                            fileReader.readAsArrayBuffer(file); // For PDFs
                        }
                        
                    });
                }
            }


            // -------------------------------------------------------------
            // D. FINALIZE AND DOWNLOAD
            // -------------------------------------------------------------
            doc.save(`Admission_Packet_${data.studentName.repla    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script src="js/admission-generator.js"></script>
    
    </body>
</html>
